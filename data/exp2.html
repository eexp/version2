<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>Experiment | 2</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="w3.css">
<link rel="stylesheet" href="css.css">
<link rel="stylesheet" href="font-awesome.css">
<style>
body,h1 {font-family: "Raleway", Arial, sans-serif}
h1 {letter-spacing: 5px}
.w3-row-padding img {margin-bottom: 12px}
</style>

<style type="text/css">/* Chart.js */
@keyframes chartjs-render-animation{from{opacity:.99}to{opacity:1}}.chartjs-render-monitor{animation:chartjs-render-animation 1ms}.chartjs-size-monitor,.chartjs-size-monitor-expand,.chartjs-size-monitor-shrink{position:absolute;direction:ltr;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1}.chartjs-size-monitor-expand>div{position:absolute;width:1000000px;height:1000000px;left:0;top:0}.chartjs-size-monitor-shrink>div{position:absolute;width:200%;height:200%;left:0;top:0}</style>

  <!--Add src=.........js that is found in the SPIFFS -->
<script src="CHART.js"> </script> 
<script id="MathJax-script" async src="MJAX.js"></script>
  <style>
  canvas{
    -moz-user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;}

  /* Data Table Styling */
  #dataTable {
    font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
    border-collapse: collapse;
    width: 100%;
  }

  #dataTable td, #dataTable th {
    border: 1px solid #ddd;
    padding: 8px;
  }

  #dataTable tr:nth-child(even){background-color: #f2f2f2;}

  #dataTable tr:hover {background-color: #ddd;}

  #dataTable th {
    padding-top: 10px;
    padding-bottom: 10px;
    text-align: left;
    background-color: #4CAF50;
    color: white;
  }

  .responsive_logo {
  width: 100%;
  max-width: 400px;
  height: auto;
}
.responsive_img {
  width: 100%;
  max-width: 800px;
  height: auto;
}
  </style>

<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* fullscreen settings */
:-webkit-full-screen {
  background-color: white;
  width: 100%;
}
:-moz-full-screen {
  background-color: white;
  width: 100%;
}
:-ms-fullscreen {
  background-color: white;
  width: 100%;
}
:fullscreen {
  background-color: white;
  width: 100%;
}
</style>


</head>



<body class="vsc-initialized">

<!-- !PAGE CONTENT! -->
<div class="w3-content" style="max-width:93%">

<!-- Header -->
<header class="w3-panel w3-center" style="padding:10px 2px">
  <div class="w3-row-padding" style="margin-bottom:8px">
    <div class="w3-center">
      <img src="logo.png" class="responsive_logo">
    </div>
   </div>

  <h1 class="w3-large">Welcome to a life of experiments</h1>
</header>
<h1> Thermodynaics of Engines </h1>

<section>
    <div class="container" style="margin-left: 10px">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <h2>Introduction: Adiabatic process</h2>
          <p class="lead">
            
            It was 1878 when Rudolf Diesel, a student at the "Polytechnikum" in Munich, learned that steam engines are capable of converting just around 8\% of the heat energy into work.  At that time, it was already theoretically known that the efficiency much larger than this could be obtained. Motivated by this, Diesel tried to build a machine as close as possible to the theoretical one. By the year 1898, he managed to realize his ideas which resulted in an engine with the effective efficiency of 26\% and him becoming a millionaire. Since then, his engine became an unavoidable part of everyday life, accounting for half cars produced each year in the world.
          </p>

         <p class="lead">
            The main idea behind the design was to use a higher compression of the fuel to ignite it rather than using a spark plug. This compression is done rapidly, not allowing a heat transfer between a cylinder of the engine (thermodynamic system) and its surroundings. This type of thermodynamic process is called an \textbf{adiabatic process}.  The statement of the zero heat transfer can be stated in the following equation:
            \(W+\Delta U = Q = 0 \label{1stlaw} \)

            where \(W\) is the work done by the system (cylinder), \(\Delta U\) is the change of the internal energy of the gas inside, and Q is the heat transfer. The internal energy of the gas is the measure of how fast the gas molecules are moving. In this respect, the equation 1 has a simple interpretation in terms of the energy conservation law, implying that the mechanical work done by the system is realized as the change in the internal energy of the gas inside the system. 
          </p>

          <p class="lead">
          In this experiment we would like to simulate an adiabatic compression which is part of the Diesel cycle, shown in Figure 1.

          <div class="w3-padding-32" style="margin-bottom:28px">
            <div class="w3-center">
              <img src="compression.jpg" class="responsive_img">
            </div>
          </div>

          As you may guess, compressing the gas inside the cylinder will cause an increase in temperature and pressure. It is exactly this fact we would like to measure. Important property of the adiabatic process we will utilize is the connection between the pressure and volume at any two different states of the system. The relation is the following:

          \begin{equation}
              P_1 V_1^\gamma = P_2 V_2^\gamma.
              \label{exponent}
          \end{equation}

          In other words we can connect the pressure \(P_1\) when the volume of the cylinder is \(V_1\), with the corresponding value \(P_2\) when the volume is changed to \(V_2\). The coefficient \(\gamma\) entering the formula is called an adiabatic exponent and will play an important role in our understanding of a microscopic structure of gas molecules. It can be rewritten as:

          \begin{equation}
              \gamma = \frac{ln(P_2/P_1)}{ln(V_2/V_1)}.
          \end{equation}
          </p>

      <h2>Introduction: Adiabatic process</h2>
          <p class="lead">
Equipment available for this experiment is show in the Figure 1.

          <div class="w3-padding-32" style="margin-bottom:28px">
            <div class="w3-center">
              <img src="equipment.jpg" class="responsive_img">
            </div>
          </div>

The first task is to connect your mobile phone with the \textit{device for collecting data}. This can be done as stated in the manual. Next, we would like to capture the change of pressure inside the pump as the function of volume. You are expected to measure the pressure for at least twenty compression cycles done at different values of the piston displacement. This situation is shown in Figure below.

          <div class="w3-padding-32" style="margin-bottom:28px">
            <div class="w3-center">
              <img src="displacement.jpg" class="responsive_img">
            </div>
          </div>

This allows us rewrite the equation 2 in the following way:


\begin{equation}
    \gamma = \frac{ln(P_2/P_1)}{ln(h_1/h_2)}.
    \label{gammanew}
\end{equation}



In the previous equation \(P_1\) corresponds to the atmospheric pressure, \(P_2\) is the pressure after the compression, while \(h_1\) and \(h_2\) are shown in Figure 3. You should ultimately measure the pressure \(P_2\) as the function of \(h_2\), for at least 3 different values of piston displacement. 


Before starting, it is crucial to close the hole through which we inserted the pressure and temperature sensor in the pump. For that purpose, you can use the tape and plasticine clay.

Measure the values of the peaks in pressure for different values of the piston displacement. Record your results in the table, find the average value of the pressure by summing the values at the peaks, and dividing by the number of peaks. Finally, use the equation 3 to calculate the adiabatic exponent \(\gamma\).




          </p>
          
        </div>
      </div>
    </div>
  </section>

<!-- Photo Example -->


<!-- Data content -->
<div style="width:95%;">
	<div class="chartjs-size-monitor">
		<div class="chartjs-size-monitor-expand">
			<div class="">
			</div>
		</div>
		<div class="chartjs-size-monitor-shrink">
			<div class="">
			</div>
		</div>
	</div>

  <div class="w3-padding-32">
  	Select Sampling Interval: 
    <select id="update_interval" onchange="updateRecording()">
      <option value="1000">1s</option>
      <option value="50">50 ms</option>
      <option value="100">100 ms</option>
      <option value="300">300 ms</option>
      <option value="500">0.5 s</option>
      <option value="2000">2 s</option>
      <option value="10000">10 s</option>
    </select>


    <div id="graph">
      <div class="w3-bar w3-border" style="font-size: 13px">
      <button onClick="startRecording()" class="w3-bar-item w3-button w3-light-grey">Start</button>
      <button onClick="stopRecording()" class="w3-bar-item w3-button">Stop</button>
      <button onClick="downloadCSV()" class="w3-bar-item w3-button w3-light-grey">Download</button>
      <button class="w3-bar-item w3-button" onclick="openFullscreen('graph')">Fullscreen</button>
    </div>
    <canvas id="canvas1" style="display: block; " width="1100" height="550" class="chartjs-render-monitor"> </canvas>
    </div>
    </div>

    <h1> I drugi Grafikon </h1>
    <div id="graph2">
     <div class="w3-bar w3-border" style="font-size: 13px">
      <button onClick="startRecording()" class="w3-bar-item w3-button w3-light-grey">Start</button>
      <button onClick="stopRecording()" class="w3-bar-item w3-button">Stop</button>
      <button onClick="downloadCSV()" class="w3-bar-item w3-button w3-light-grey">Download</button>
      <button class="w3-bar-item w3-button" onclick="openFullscreen('graph2')">Fullscreen</button>
    </div>
    <canvas id="canvas2" style="display: block; " width="1100" height="550" class="chartjs-render-monitor"> </canvas>
    </div>
  </div>

<style>
div.ex3 {
  background-color: white;
  width: 320px;
  height: 500px;
  overflow: scroll;
}
</style>

<center>
<div class="ex3 w3-center hub_specification_logo">
  <table id="dataTable">
    <tr><th>Time</th><th>Temp</th><th>Press</th></tr>
  </table>
</div>
Download the data: 
<button onClick="downloadCSV()" class="w3-bar-item w3-button w3-hover-text-green">Download
</button>
</center>
<br>
<br>  


<script>
function openFullscreen(elementt) {
  var elem = document.getElementById(elementt);
  if (elem.requestFullscreen) {
    elem.requestFullscreen();
  } else if (elem.mozRequestFullScreen) { /* Firefox */
    elem.mozRequestFullScreen();
  } else if (elem.webkitRequestFullscreen) { 
    elem.webkitRequestFullscreen();
  } else if (elem.msRequestFullscreen) { /* IE/Edge */
    elem.msRequestFullscreen();
  }
}
</script>

<script>
//Graphs visit: https://www.chartjs.org
var Temperature = [];
var Pressure  = [];
var timeStamp = [];
var timeMilis = [];
var scatterData = [];

window.chartColors = {
  red: 'rgb(255, 99, 132)',
  orange: 'rgb(255, 159, 64)',
  yellow: 'rgb(255, 205, 86)',
  green: 'rgb(75, 192, 192)',
  blue: 'rgb(54, 162, 235)',
  purple: 'rgb(153, 102, 255)',
  grey: 'rgb(201, 203, 207)'
  };
var config1 = {
      type: 'line',
      data: {
        labels: timeStamp,
        datasets: [{
          label: 'Temperature',
          backgroundColor: window.chartColors.red,
          borderColor: window.chartColors.red,
          data: Temperature,
          fill: false,
          yAxisID: 'Taxis',
        },{
          label: 'Pressure',
          backgroundColor: window.chartColors.blue,
          borderColor: window.chartColors.blue,
          data: Pressure,
          fill: false,
          yAxisID: 'Paxis',
        }]
      },
      options: {
        responsive: true,
        tooltips: {
          mode: 'index',
          intersect: false,
        },
        hover: {
          mode: 'nearest',
          intersect: true
        },
        scales: {
          xAxes: [{
            display: true,
            scaleLabel: {
              display: true,
              labelString: 'Time'
            }
          }],
          yAxes: [{
            id: 'Taxis',
            display: true,
            scaleLabel: {
              display: true,
              labelString: 'Temperature',
              position: 'left',
            }
          },{
            id: 'Paxis',
            display: true,
            scaleLabel: {
              display: true,
              labelString: 'Pressure',
              position: 'right',
            }
          }]
        }
      }
    };

var config2 = {
      type: 'scatter',
    data: {datasets: 
      [{ label: 'Pressure/Temperature',
          data: scatterData,
        }]
    },
    options: {
        scales: {
            xAxes: [{
                type: 'linear',
                position: 'bottom',
                scaleLabel: {
              display: true,
              labelString: 'Temperature'
            },
            }],
            yAxes: [{
                type: 'linear',
                position: 'left',
                scaleLabel: {
              display: true,
              labelString: 'Pressure'
            },
            }]
        }
    }
    };

window.onload = function() {
      var ctx1 = document.getElementById('canvas1').getContext('2d');
      window.myLine1 = new Chart(ctx1, config1); //First graph
      var ctx2 = document.getElementById('canvas2').getContext('2d');
      window.myLine2 = new Chart(ctx2, config2);

      recording_active = false;
      wakeUp("exp2")
    };


//Ajax script to get ADC voltage at every 5 Seconds 
//Read This tutorial https://circuits4you.com/2018/02/04/esp8266-ajax-update-part-of-web-page-without-refreshing/


function startRecording(){
  if(recording_active == false){
    recording_active = true;
    interval = document.getElementById("update_interval").value;
    myTimer = setInterval(getData, interval);
    start_time = new Date().getTime();
  }
  else{
    alert("Recording already in progress!");
  }
}

function updateRecording(){
  if(recording_active == true){
    clearInterval(myTimer);
    interval = document.getElementById("update_interval").value;
    myTimer = setInterval(getData, interval);
  }
}

function stopRecording(){
  if(recording_active ==true){
    recording_active = false;
    clearInterval(myTimer);
  }
  else{
    alert("No active recording!");
  }
}

function downloadCSV(){
  if(recording_active == false){
    let csvContent = "data:text/csv;charset=utf-8,";
    var i;
    csvContent += "time, temperature, pressure\r\n";
    for (i = 0; i < Temperature.length; i++) {
      csvContent += timeMilis[i] +"," + Temperature[i] + "," + Pressure[i] + "\r\n";
    }  
    var encodedUri = encodeURI(csvContent);
    window.open(encodedUri);
  } else{
    alert("Recording must be stoped!");
  }
}


function wakeUp(var1) {
  var xhttp = new XMLHttpRequest();
  xhttp.open("GET", var1, true); //Handle /stuff server on ESP8266
  xhttp.send();
}

function getData() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
     //Push the data in array
  var time = new Date();
  var ADCValue = this.responseText; 
  var SplitData = ADCValue.split(",")
      Temperature.push(SplitData[0]);
      Pressure.push(SplitData[1]);
      scatterData.push({x:SplitData[0], y:SplitData[1]});
      timeStamp.push(time.toLocaleTimeString());
      timeMilis.push(time.getTime() - start_time);
  //Update Plot
  window.myLine1.update();
  window.myLine2.update();

  //Update Data Table
    var table = document.getElementById("dataTable");
    var row = table.insertRow(1); //Add after headings
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    var cell3 = row.insertCell(2);
    cell1.innerHTML = time.toLocaleTimeString();
    cell2.innerHTML = ADCValue.split(",")[0];
    cell3.innerHTML = ADCValue.split(",")[1];
    }
  };
  xhttp.open("GET", "readBAR", true); //Handle readADC server on ESP8266
  xhttp.send();
}
    
</script>
  
<!-- End Page Content -->
</div>

<!-- Footer -->
<footer class="w3-container w3-padding-64 w3-light-grey w3-center w3-large"> 
  <p>Project by <a href="https://expertexperiments.ba" target="_blank" class="w3-hover-text-green">ExpertExperiments</a></p>
</footer>


</body></html>